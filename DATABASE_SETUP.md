# 数据库初始化说明

## 用户游戏历史记录功能

要使用用户游戏历史记录功能，需要在Supabase数据库中执行以下SQL文件：

### 1. 执行SQL文件

运行 `user-game-history.sql` 文件来创建必要的表、索引和函数：

```bash
# 在Supabase SQL编辑器中执行此文件的内容
# 或者使用Supabase CLI
supabase db push
```

### 2. SQL文件包含的内容

- `user_game_history` 表：存储用户游戏历史记录
- 索引：提高查询性能
- 行级安全策略：确保用户只能访问自己的数据
- `upsert_game_history` 函数：用于插入或更新游戏历史记录
- 触发器：自动更新 `updated_at` 字段

### 3. 功能说明

如果数据库表尚未创建，API会优雅地降级：
- 游戏历史页面会显示空状态
- 游戏记录功能会静默失败，不会影响用户体验
- 当数据库表创建后，功能会自动生效

### 4. 错误处理

API已实现完整的错误处理：
- 表不存在时返回空数据而不是错误
- 函数不存在时使用备用逻辑
- 所有的数据库操作都有try-catch保护

这样即使用户还没有执行SQL文件，网站也能正常运行，不会出现错误页面。